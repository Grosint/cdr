<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDR Intelligence Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.css" type="text/css" />
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://unpkg.com/vis-network@9.1.9/dist/vis-network.min.js"></script>
    <link href="https://unpkg.com/vis-network@9.1.9/dist/vis-network.min.css" rel="stylesheet" />
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">CDR Intelligence</h1>
                <p class="tagline">Telecom Data Analysis Platform</p>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-view="upload">
                    <span class="nav-icon">üì§</span>
                    <span>Upload CDR</span>
                </button>
                <button class="nav-item" data-view="single-analysis">
                    <span class="nav-icon">üîç</span>
                    <span>Single Analysis</span>
                </button>
                <button class="nav-item" data-view="multiple-analysis">
                    <span class="nav-icon">üîó</span>
                    <span>Multiple Analysis</span>
                </button>
                <button class="nav-item" data-view="utils">
                    <span class="nav-icon">üõ†Ô∏è</span>
                    <span>Utilities</span>
                </button>
                <button class="nav-item" data-view="geofencing">
                    <span class="nav-icon">üåê</span>
                    <span>Geofencing</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span>Checking connection...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload View -->
            <div class="view" id="uploadView">
                <div class="view-header">
                    <h2>Upload CDR Files</h2>
                    <p>Upload and process Call Detail Records from various telecom vendors</p>
                </div>

                <div class="glass-card upload-card">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <h3>Drag & Drop CDR Files</h3>
                        <p>Supports CSV, XLS, XLSX, JSON formats</p>
                        <input type="file" id="fileInput" accept=".csv,.xls,.xlsx,.json" multiple style="display: none;">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            Browse Files
                        </button>
                    </div>

                    <div class="upload-options">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoDetect" checked>
                                Auto-detect file format
                            </label>
                        </div>
                    </div>

                    <div id="uploadProgress" class="upload-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p id="progressText">Processing...</p>
                    </div>

                    <div id="uploadResults" class="upload-results"></div>
                </div>

            </div>

            <!-- Analysis View -->
            <div class="view" id="singleAnalysisView" style="display: none;">
                <div class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2>CDR Analysis Results</h2>
                        <p>Comprehensive analysis of uploaded CDR data</p>
                    </div>
                    <button class="btn btn-primary" id="advancedBtn" onclick="showAdvancedDashboard()" style="background: linear-gradient(135deg, #8b5cf6, #ec4899);">
                        üß† Advanced Intelligence Dashboard
                    </button>
                </div>

                <div class="analysis-tabs">
                    <button class="tab-btn active" data-tab="summary">Summary</button>
                    <button class="tab-btn" data-tab="corrected">Corrected</button>
                    <button class="tab-btn" data-tab="max-call">Max Call</button>
                    <button class="tab-btn" data-tab="max-circle-call">Max Circle Call</button>
                    <button class="tab-btn" data-tab="daily-first-last">Daily First/Last</button>
                    <button class="tab-btn" data-tab="max-duration">Max Duration</button>
                    <button class="tab-btn" data-tab="max-imei">Max IMEI</button>
                    <button class="tab-btn" data-tab="daily-imei-tracking">Daily IMEI Tracking</button>
                    <button class="tab-btn" data-tab="max-location">Max Location</button>
                    <button class="tab-btn" data-tab="daily-first-last-location">Daily First/Last Location</button>
                    <button class="tab-btn" data-tab="imei">IMEI Analysis</button>
                    <button class="tab-btn" data-tab="towers">Cell Towers</button>
                    <button class="tab-btn" data-tab="contacts">Contacts</button>
                    <button class="tab-btn" data-tab="sms">SMS Services</button>
                    <button class="tab-btn" data-tab="international">International</button>
                </div>

                <div class="tab-content active" id="summaryTab">
                    <div class="glass-card">
                        <h3>Summary</h3>
                        <div id="summaryContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="correctedTab">
                    <div class="glass-card">
                        <h3>Corrected Dataset</h3>
                        <div id="correctedContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="maxCallTab">
                    <div class="glass-card">
                        <h3>Max Call</h3>
                        <div id="maxCallContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="maxCircleCallTab">
                    <div class="glass-card">
                        <h3>Max Circle Call</h3>
                        <div id="maxCircleCallContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="dailyFirstLastTab">
                    <div class="glass-card">
                        <h3>Daily First & Last Call</h3>
                        <div id="dailyFirstLastContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="maxDurationTab">
                    <div class="glass-card">
                        <h3>Max Duration</h3>
                        <div id="maxDurationContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="maxImeiTab">
                    <div class="glass-card">
                        <h3>Max IMEI</h3>
                        <div id="maxImeiContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="dailyImeiTrackingTab">
                    <div class="glass-card">
                        <h3>Daily IMEI Tracking</h3>
                        <div id="dailyImeiTrackingContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="maxLocationTab">
                    <div class="glass-card">
                        <h3>Max Location</h3>
                        <div id="maxLocationContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="dailyFirstLastLocationTab">
                    <div class="glass-card">
                        <h3>Daily First & Last Location</h3>
                        <div id="dailyFirstLastLocationContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="imeiTab">
                    <div class="glass-card">
                        <h3>IMEI Device Analysis</h3>
                        <div id="imeiContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="towersTab">
                    <div class="glass-card">
                        <h3>Cell Tower Locations</h3>
                        <div style="margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                            <div class="form-group" style="flex: 1; min-width: 200px;">
                                <label>Start Date/Time</label>
                                <input type="datetime-local" id="towerStartDate" class="select-input">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 200px;">
                                <label>End Date/Time</label>
                                <input type="datetime-local" id="towerEndDate" class="select-input">
                            </div>
                            <div class="form-group" style="display: flex; align-items: flex-end;">
                                <button class="btn btn-primary" onclick="loadTowerAnalysis(document.getElementById('singleSuspectSelect').value)">Apply Filter</button>
                            </div>
                        </div>
                        <div id="towerMap" class="map-container"></div>
                    </div>
                </div>

                <div class="tab-content" id="contactsTab">
                    <div class="glass-card">
                        <h3>Contact Analysis</h3>
                        <div id="contactsContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="smsTab">
                    <div class="glass-card">
                        <h3>SMS Service Detection</h3>
                        <div id="smsContent"></div>
                    </div>
                </div>

                <div class="tab-content" id="internationalTab">
                    <div class="glass-card">
                        <h3>International Calls</h3>
                        <div id="internationalContent"></div>
                    </div>
                </div>
            </div>

            <!-- Advanced Intelligence Dashboard View -->
            <div class="view" id="advancedDashboardView" style="display: none;">
                <div class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2>üß† Intelligence Dashboard</h2>
                        <p>Advanced CDR analysis with intelligence-grade insights</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideAdvancedDashboard()">
                        ‚Üê Back to Standard View
                    </button>
                </div>

                <!-- Filters Header -->
                <div class="glass-card" id="caseHeader" style="margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">CASE ID</label>
                            <div style="font-size: 1.1rem; font-weight: 600;" id="caseId">CDR_INV_2025_001</div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">TARGET MSISDN</label>
                            <div style="font-size: 1.1rem; font-weight: 600;" id="targetMsisdn">--</div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">STATUS</label>
                            <div style="font-size: 1.1rem; font-weight: 600; color: #10b981;" id="caseStatus">ACTIVE</div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">START DATE</label>
                            <input type="date" id="dateRangeStart" class="select-input" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">END DATE</label>
                            <input type="date" id="dateRangeEnd" class="select-input" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">ACTIONS</label>
                            <button class="btn btn-primary" onclick="applyAdvancedFilters()" style="width: 100%;">Apply Filters</button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid Layout -->
                <div class="advanced-dashboard-grid">
                    <!-- Overview KPIs -->
                    <div class="glass-card">
                        <h3>üìä Overview KPIs</h3>
                        <div class="stats-grid" id="overviewKpis" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));"></div>
                    </div>

                    <!-- Intelligence Story -->
                    <div class="glass-card">
                        <h3>üìñ Intelligence Story</h3>
                        <div id="intelligenceStory" style="color: var(--text-secondary); line-height: 1.6; min-height: 100px;"></div>
                    </div>

                    <!-- Active Alerts -->
                    <div class="glass-card">
                        <h3>‚ö†Ô∏è Active Alerts</h3>
                        <div id="activeAlerts" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>

                    <!-- Contact Network Graph -->
                    <div class="glass-card">
                        <h3>üï∏Ô∏è Contact Network Graph</h3>
                        <div id="networkGraphContainer" class="network-container" style="height: 500px;"></div>
                    </div>

                    <!-- Temporal Activity Heatmap -->
                    <div class="glass-card">
                        <h3>‚è±Ô∏è Temporal Activity Heatmap</h3>
                        <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="tab-btn active" onclick="toggleHeatmapType('all')">All</button>
                            <button class="tab-btn" onclick="toggleHeatmapType('incoming')">Incoming</button>
                            <button class="tab-btn" onclick="toggleHeatmapType('outgoing')">Outgoing</button>
                            <button class="tab-btn" onclick="toggleHeatmapType('sms')">SMS</button>
                        </div>
                        <div id="heatmapContainer" style="height: 400px;"></div>
                    </div>

                    <!-- IMEI Switch & Device Behavior -->
                    <div class="glass-card">
                        <h3>üì± IMEI Switch & Device Behavior</h3>
                        <div id="imeiTimelineContainer" style="height: 350px; margin-bottom: 1rem;"></div>
                        <div id="imeiDetails" style="max-height: 200px; overflow-y: auto;"></div>
                    </div>

                    <!-- Geo-Spatial Movement Map -->
                    <div class="glass-card">
                        <h3>üó∫Ô∏è Geo-Spatial Movement Map</h3>
                        <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="tab-btn active" onclick="toggleLocationLayer('day')">Day-wise</button>
                            <button class="tab-btn" onclick="toggleLocationLayer('imei')">IMEI-wise</button>
                            <button class="tab-btn" onclick="toggleLocationLayer('contact')">Contact-wise</button>
                        </div>
                        <div id="movementMap" class="map-container" style="height: 400px;"></div>
                    </div>

                    <!-- Co-location Analysis -->
                    <div class="glass-card">
                        <h3>üë• Co-location Analysis</h3>
                        <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <label style="margin: 0;">Time Window: </label>
                            <select id="colocationWindow" class="select-input" style="width: auto;">
                                <option value="15">¬±15 minutes</option>
                                <option value="30">¬±30 minutes</option>
                                <option value="60">¬±1 hour</option>
                            </select>
                            <button class="btn btn-primary" onclick="analyzeColocation()">Analyze</button>
                        </div>
                        <div id="colocationResults" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>

                    <!-- Anomaly & Alert Panel -->
                    <div class="glass-card">
                        <h3>üß® Anomaly & Alert Panel</h3>
                        <div id="anomaliesList" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>

                    <!-- Audit Trail -->
                    <div class="glass-card">
                        <h3>üîç Forensic / Audit View</h3>
                        <div id="auditTrail" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>

            <!-- Multiple Analysis View -->
            <div class="view" id="multipleAnalysisView" style="display: none;">
                <div class="view-header">
                    <h2>Multiple CDR Analysis</h2>
                    <p>Compare and find connections between multiple suspects</p>
                </div>

                <div class="glass-card">
                    <div class="form-group">
                        <label>Select Suspects (Multiple)</label>
                        <div id="multipleSuspectSelect" class="multi-select">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button class="btn btn-primary" onclick="loadMultipleAnalysis()">Analyze</button>
                    </div>
                </div>

                <div class="analysis-tabs">
                    <button class="tab-btn active" data-tab="common-numbers">Common Numbers</button>
                    <button class="tab-btn" data-tab="common-towers">Common Towers</button>
                    <button class="tab-btn" data-tab="common-imei">Common IMEI</button>
                </div>

                <div class="tab-content active" id="commonNumbersTab">
                    <div class="glass-card">
                        <h3>Common Numbers Network</h3>
                        <div id="networkGraph" class="network-container"></div>
                    </div>
                </div>

                <div class="tab-content" id="commonTowersTab">
                    <div class="glass-card">
                        <h3>Common Cell Towers Map</h3>
                        <div id="towersMap" class="map-container"></div>
                    </div>
                </div>

                <div class="tab-content" id="commonImeiTab">
                    <div class="glass-card">
                        <h3>Common IMEI Devices</h3>
                        <div id="commonImeiContent"></div>
                    </div>
                </div>
            </div>

            <!-- Utilities View -->
            <div class="view" id="utilsView" style="display: none;">
                <div class="view-header">
                    <h2>Utilities</h2>
                    <p>Tools and utilities for CDR data management</p>
                </div>

                <div class="glass-card">
                    <h3>Generate Sample Data</h3>
                    <div class="form-group">
                        <label>Suspect Name</label>
                        <input type="text" id="sampleSuspectName" placeholder="Enter suspect name">
                    </div>
                    <div class="form-group">
                        <label>Number of Records</label>
                        <input type="number" id="sampleRecordCount" value="100" min="10" max="10000">
                    </div>
                    <button class="btn btn-primary" onclick="generateSampleData()">Generate</button>
                    <div id="sampleDataResult"></div>
                </div>

                    <div class="glass-card">
                    <h3>Export Data</h3>
                    <div class="form-group">
                        <label>Select Suspect</label>
                        <select id="exportSuspectSelect" class="select-input">
                            <option value="">-- Select Suspect --</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="exportData('excel')" style="background: linear-gradient(135deg, #10b981, #059669);">Export to Excel (Multi-Sheet)</button>
                        <button class="btn btn-primary" onclick="exportData('json')">Export to JSON</button>
                        <button class="btn btn-secondary" onclick="exportData('csv')">Export to CSV</button>
                        <button class="btn btn-primary" onclick="exportData('kml')" style="background: linear-gradient(135deg, #10b981, #3b82f6);">Export to KML (Google Earth)</button>
                        <button class="btn btn-primary" onclick="exportPDF()" style="background: linear-gradient(135deg, #ec4899, #8b5cf6);">Export PDF Report</button>
                    </div>
                </div>
            </div>

            <!-- Geofencing View -->
            <div class="view" id="geofencingView" style="display: none;">
                <div class="view-header">
                    <h2>Geofencing</h2>
                    <p>Create and manage geofences for real-time alerts</p>
                </div>
                <div class="glass-card">
                    <div id="geofenceMap" class="map-container"></div>
                </div>
                <div class="glass-card">
                    <h3>Create Geofence</h3>
                    <div class="form-group">
                        <label>Geofence Name</label>
                        <input type="text" id="geofenceName" class="select-input">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="geofenceDescription" class="select-input">
                    </div>
                    <div class="form-group">
                        <label>Suspect Name</label>
                        <select id="geofenceSuspect" class="select-input"></select>
                    </div>
                    <button class="btn btn-primary" onclick="saveGeofence()">Save Geofence</button>
                </div>
                <div class="glass-card">
                    <h3>Existing Geofences</h3>
                    <div id="geofenceList"></div>
                </div>
                <div class="glass-card">
                    <h3>Real-time Alerts</h3>
                    <div id="geofenceAlerts"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
